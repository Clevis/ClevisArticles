(function(g,b){"object"===typeof exports?b(exports):"function"===typeof define&&define.amd?define(["exports"],b):b(g)})(this,function(g){function b(a){this._targetElement=a;this._wideAreaId=1;this._options={wideAreaAttr:"data-widearea",exitOnEsc:!0,defaultColorScheme:"light",closeIconLabel:"Close WideArea",changeThemeIconLabel:"Toggle Color Scheme",fullScreenIconLabel:"WideArea Mode"};q.call(this)}function q(){var a=this,d=this._targetElement.querySelectorAll("textarea["+this._options.wideAreaAttr+
"='enable']"),e=function(){r.call(a,this)};save=function(){var a="WDATA-"+this.getAttribute("data-widearea-id");localStorage.setItem(a,this.value);console.log(a+"="+this.value)};this._textareas=[];for(var f=d.length-1;0<=f;f--){var c=d[f],l=document.createElement("div"),h=document.createElement("div"),b=document.createElement("a");l.className="widearea-wrapper";h.className="widearea-icons";b.className="widearea-icon fullscreen";b.title=this._options.fullScreenIconLabel;b.href="javascript:void(0);";
b.draggable=!1;b.onclick=e;c.className+=(c.className+" widearea").replace(/^\s+|\s+$/g,"");c.setAttribute("data-widearea-id",this._wideAreaId);h.setAttribute("id","widearea-"+this._wideAreaId);++this._wideAreaId;var g="WDATA-"+c.getAttribute("data-widearea-id");localStorage.getItem(g)&&(c.value=localStorage.getItem(g));c.addEventListener?c.addEventListener("input",save,!1):c.attachEvent&&c.attachEvent("onpropertychange",save);n(c,h);h.appendChild(b);l.appendChild(h);document.body.appendChild(l);this._textareas.push(c)}this._timer=
setInterval(function(){for(var d=a._textareas.length-1;0<=d;d--){var e=a._textareas[d],c=document.getElementById("widearea-"+e.getAttribute("data-widearea-id")),f=m(c),b=m(e);f.left-b.width+21==b.left&&f.top==b.top||n(e,c,b)}},200)}function n(a,d,e){a=e||m(a);d.style.left=a.left+a.width-21+"px";d.style.top=a.top+"px"}function m(a){var d={};d.width=a.offsetWidth;d.height=a.offsetHeight;for(var e=0,f=0;a&&!isNaN(a.offsetLeft)&&!isNaN(a.offsetTop);)e+=a.offsetLeft,f+=a.offsetTop,a=a.offsetParent;d.top=
f;d.left=e;return d}function r(a){var d=this;a=parseInt(a.parentNode.id.replace(/widearea\-/,""));a=document.querySelector("textarea[data-widearea-id='"+a+"']");var e=a.cloneNode();e.className=("widearea-fullscreen "+a.className).replace(/^\s+|\s+$/g,"");a.className=("widearea-fullscreened "+a.className).replace(/^\s+|\s+$/g,"");var f=document.createElement("div");f.className="widearea-controlPanel";var c=document.createElement("a");c.href="javascript:void(0);";c.className="widearea-icon close";c.title=
this._options.closeIconLabel;c.onclick=function(){p.call(d)};c.draggable=!1;var b=document.createElement("a");b.href="javascript:void(0);";b.className="widearea-icon changeTheme";b.title=this._options.changeThemeIconLabel;b.onclick=function(){s.call(d)};b.draggable=!1;f.appendChild(c);f.appendChild(b);c=document.createElement("div");c.className="widearea-overlayLayer "+this._options.defaultColorScheme;c.appendChild(e);c.appendChild(f);document.body.appendChild(c);e.focus();e.value=a.value;this._onKeyDown=
function(a){if(27===a.keyCode&&d._options.exitOnEsc){textAreas=document.getElementsByClassName("widearea-fullscreen");var b="WDATA-"+textAreas[0].getAttribute("data-widearea-id");localStorage.setItem(b,textAreas[0].value);p.call(d)}9==a.keyCode&&(a.preventDefault(),a=e.selectionStart,e.value=e.value.substring(0,a)+"\t"+e.value.substring(e.selectionEnd),e.selectionEnd=a+1)};window.addEventListener?window.addEventListener("keydown",d._onKeyDown,!0):document.attachEvent&&document.attachEvent("onkeydown",
d._onKeyDown)}function s(){var a=document.querySelector(".widearea-overlayLayer");/dark/gi.test(a.className)?a.className=a.className.replace("dark","light"):a.className=a.className.replace("light","dark")}function p(){var a=document.querySelector("textarea.widearea-fullscreened"),d=document.querySelector(".widearea-overlayLayer"),b=d.querySelector("textarea");textAreas=document.getElementsByClassName("widearea-fullscreen");var f="WDATA-"+textAreas[0].getAttribute("data-widearea-id");localStorage.setItem(f,
textAreas[0].value);a.focus();a.value=b.value;a.className=a.className.replace(/widearea-fullscreened/gi,"").replace(/^\s+|\s+$/g,"");d.parentNode.removeChild(d);window.removeEventListener?window.removeEventListener("keydown",this._onKeyDown,!0):document.detachEvent&&document.detachEvent("onkeydown",this._onKeyDown)}var k=function(a){if("string"===typeof a){if(a=document.querySelector(a))return new b(a);throw Error("There is no element with given selector.");}return new b(document.body)};k.version=
"0.2.0";k.fn=b.prototype={clone:function(){return new b(this)},setOption:function(a,b){this._options[a]=b;return this},setOptions:function(a){var b=this._options,e={},f;for(f in b)e[f]=b[f];for(f in a)e[f]=a[f];this._options=e;return this}};g.wideArea=k;g.clearData=function(a){localStorage.remove("WDATA-"+a.getAttribute("data-widearea-id"))};return k});
